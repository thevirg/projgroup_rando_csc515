# Course Utils

`course_utils.py` is a unified **command-line toolkit** for common course administration workflows.

## Commands

### 1. Slice Exams (`slice`)

Merge and split scanned exam PDFs into perâ€‘question documents, detect drawingâ€‘heavy pages, and generate logs.

```bash
python course_utils.py slice \
  --input_dir /path/to/student_scans \
  --output_dir /path/to/output \
  [--workers N]
```

- `--input_dir`  : Root directory containing one subfolder per student (named by student ID).
- `--output_dir` : Destination for perâ€‘question PDFs and drawing log.
- `--workers`    : (Optional) Number of parallel processes (default = CPU count).

---

### 2. Generate Peerâ€‘Review Groups (`gen-groups`)

Create rotational peerâ€‘review assignments from a roster CSV (alternating name,email columns).

```bash
python course_utils.py gen-groups roster.csv [--projects P]
```

- `roster.csv` : CSV file where each row alternates student name and email.
- `--projects` : (Optional) Number of distinct review projects (default = 4).

Output: `projgroups.csv` with columns:

```
Project, Group A, Group B, Emails A, Emails B, Names A, Names B
```

---

### 3. Rename Submissions (`rename`)

Rename Gradescope export files to indicate reviewer assignment, based on group pairings and metadata.

```bash
python course_utils.py rename projgroups.csv metadata.yaml --project N
```

- `projgroups.csv`  : CSV generated by `gen-groups`.
- `metadata.yaml`   : Gradescope metadata export (YAML).
- `--project`       : Project number (e.g., `3`).

Output: Files renamed to `P<N>PeerEval_sendto_<TargetGroup>.<ext>` and log `eval_sources.txt`.

---

## Installation

```bash
pip install pypdf pytesseract opencv-python pillow tqdm pdf2image pyyaml

# macOS
brew install tesseract poppler

# Debian/Ubuntu
sudo apt-get install tesseract-ocr poppler-utils
```

## Configuration

- **QUESTION_REGEX**       : Regex in script for detecting question headers.
- **EDGE_DETECT_THRESHOLD**: Edge count threshold for drawing detection.
- **DEFAULT_DPI**          : DPI for PDFâ†’image conversion.

Adjust these constants at the top of `course_utils.py` to match your exam formatting and performance needs.

## Logs & Outputs

- **Slice**      : Creates `/output/<student_id>/` with `*_Q<n>[_drawing].pdf` and `drawing_detection_log.txt`.
- **gen-groups** : Writes `projgroups.csv` to current directory.
- **rename**     : Renames files and writes `eval_sources.txt`.

## Troubleshooting

- **Tesseract not found**: Ensure `tesseract` is on your PATH.
- **Poppler error**       : Install Poppler utilities.
- **CSV/YAML format**     : Verify input files match expected structure.

---

## License

Open-source educational tool. Adapt and extend freely.

---

Happy grading and group management! ðŸš€
